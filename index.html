<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ¶ã¡ã‚‡ã“ã®ãƒˆã‚¤ãƒ¬è¨˜éŒ²ğŸš½</title>
    <link rel="manifest" href="manifest.json" />
    <script>
            if ("serviceWorker" in navigator) {
                window.addEventListener("load", () => {
                    navigator.serviceWorker
                        .register("sw.js")
                        .then(
                            (registration) => {
                                console.log("ServiceWorker registration successful with scope: ", registration.scope);
                            },
                            (err) => {
                                console.log("ServiceWorker registration failed: ", err);
                            }
                        )
                        .catch((err) => {
                            console.log(err);
                        });
                });
            }
        </script>
    <style>
                body {
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", YuGothic, "ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ ProN W3", Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f7f6;
            color: #333;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }


        h1 {
            text-align: center;
            font-size: 1.4rem;
            color: #555;
            margin-bottom: 20px;
        }

        /* æœ€æ–°æƒ…å ±ã®è¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .status-card {
            background: white;
            padding: 20px 15px;
            border-radius: 16px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            margin-bottom: 25px;
            text-align: center;
        }
        .status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
        }
        .status-label {
            font-size: 1rem;
            color: #666;
            text-align: left;
            width: 80px;
        }
        .status-value {
            text-align: right;
            flex-grow: 1;
        }
        .time-display {
            display: block;
            font-weight: 800;
            font-size: 1.6rem;
            color: #2c3e50;
            line-height: 1.2;
        }
        .status-detail {
            font-size: 0.85rem;
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 12px;
            display: inline-block;
            margin-top: 4px;
        }
        .tag-ok { color: #d35400; background: #fff5e6; border: 1px solid #f39c12; }
        .tag-ng { color: #2980b9; background: #eaf6ff; border: 1px solid #3498db; }

        .date-label {
            font-size: 0.9rem;
            font-weight: normal;
            color: #888;
            margin-right: 8px;
        }

        /* åŒºåˆ‡ã‚Šç·š */
        .divider {
            height: 1px;
            background: #eee;
            margin: 5px 20px;
        }

        /* ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ */
        .section-title {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 8px;
            margin-left: 5px;
            font-weight: bold;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        button.action-btn {
            border: none;
            border-radius: 16px;
            padding: 20px 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            color: white;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100px;
            border-bottom: 5px solid rgba(0,0,0,0.2); 
            box-shadow: 0 3px 5px rgba(0, 0, 0, .2);
            transition: transform 0.8s, border-bottom-width 0.8s;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        button.action-btn:active,
        button.action-btn.pressed {
            transform: translateY(3px);
            border-bottom-width: 2px;
            box-shadow: none;
            transition: none;
        }

        #btn-pee-ok { background-color: #FFC107; border-bottom-color: #bfa004; color: #444; }
        #btn-pee-ng { background-color: #5DADE2; border-bottom-color: #2e86c1; }
        #btn-poo-ok { background-color: #8d6e63; border-bottom-color: #5d4037; }
        #btn-poo-ng { background-color: #78909c; border-bottom-color: #455a64; }

        
        
        /* å±¥æ­´ã‚¨ãƒªã‚¢ */
        .history-section {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        .toggle-btn {
            width: 100%;
            background-color: #f0f2f5;
            color: #555;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: bold;
        }

        #history-list {
            display: none;
            list-style: none;
            padding: 0;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .date-header {
            background-color: #eef2f5;
            padding: 8px 12px;
            margin-top: 20px;
            font-weight: bold;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #555;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .log-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 5px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .log-info {
            display: flex;
            align-items: center;
            flex-grow: 1;
        }
        
        .log-type {
            font-weight: bold;
            font-size: 1rem;
            margin-right: 10px;
        }
        
        .type-pee-ok { color: #f39c12; }
        .type-pee-ng { color: #3498db; }
        .type-poo-ok { color: #795548; }
        .type-poo-ng { color: #607d8b; }
        .type-poo    { color: #795548; }

        .log-time {
            font-size: 1.1rem;
            color: #333;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .edit-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 6px 10px;
            font-size: 0.8rem;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 6px 10px;
            font-size: 0.8rem;
            border-radius: 6px;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <h1>ğŸ¶ã¡ã‚‡ã“ã®ãƒˆã‚¤ãƒ¬è¨˜éŒ²ğŸš½</h1>

    <div class="status-card">
        <div class="status-row">
            <div class="status-label">ãŠã—ã£ã“</div>
            <div class="status-value">
                <span id="last-pee" class="time-display">--</span>
                <span id="last-pee-detail"></span>
            </div>
        </div>
        <div class="divider"></div>
        <div class="status-row">
            <div class="status-label">ã†ã‚“ã“</div>
            <div class="status-value">
                <span id="last-poo" class="time-display">--</span>
                <span id="last-poo-detail"></span>
            </div>
        </div>
    </div>

    <div class="section-title">ãŠã—ã£ã“</div>
    <div class="button-group">
        <button id="btn-pee-ok" class="action-btn" onclick="addLog('ãŠã—ã£ã“ï¼ˆæˆåŠŸï¼‰')">
            <span class="icon">ğŸ˜Š</span>
            æˆåŠŸ
        </button>
        <button id="btn-pee-ng" class="action-btn" onclick="addLog('ãŠã—ã£ã“ï¼ˆå¤±æ•—ï¼‰')">
            <span class="icon">ğŸ˜­</span>
            å¤±æ•—
        </button>
    </div>

    <div class="section-title">ã†ã‚“ã“</div>
    <div class="button-group">
        <button id="btn-poo-ok" class="action-btn" onclick="addLog('ã†ã‚“ã“ï¼ˆæˆåŠŸï¼‰')">
            <span class="icon">ğŸ’©</span>
            æˆåŠŸ
        </button>
        <button id="btn-poo-ng" class="action-btn" onclick="addLog('ã†ã‚“ã“ï¼ˆå¤±æ•—ï¼‰')">
            <span class="icon">ğŸ˜±</span>
            å¤±æ•—
        </button>
    </div>

    <div class="history-section">
        <button class="toggle-btn" onclick="toggleHistory()">ğŸ“… å±¥æ­´ã‚’è¡¨ç¤º / éè¡¨ç¤º</button>
        <ul id="history-list">
            </ul>
        <div style="text-align: center; margin-top: 20px;">
            <button onclick="clearAllData()" style="background:none; border:none; color:#ccc; font-size:0.8rem; cursor:pointer;">å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤</button>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'toilet_log_v5'; // ãƒãƒ¼ã‚¸ãƒ§ãƒ³5
        let logs = [];

        window.onload = function() {
            loadLogs();
            updateDisplay();
        };

        function addLog(type) {
            const now = new Date();
            const record = {
                id: Date.now(),
                type: type,
                timestamp: now.getTime()
            };
            logs.unshift(record);
            saveLogs();
            updateDisplay();
            if (document.getElementById('history-list').style.display === 'block') {
                renderHistory();
            }
        }

        // æ™‚é–“ã®ç·¨é›†æ©Ÿèƒ½
        function editLog(id) {
            const logIndex = logs.findIndex(log => log.id === id);
            if (logIndex === -1) return;
            
            const log = logs[logIndex];
            const oldTime = formatTime(log.timestamp);
            
            // å…¥åŠ›ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
            const newTimeStr = prompt('æ™‚é–“ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ (ä¾‹: 12:30)', oldTime);
            
            if (newTimeStr && newTimeStr !== oldTime) {
                // å…¥åŠ›ã•ã‚ŒãŸæ™‚é–“ã‚’è§£æ
                const parts = newTimeStr.split(':');
                if (parts.length === 2) {
                    const hours = parseInt(parts[0]);
                    const minutes = parseInt(parts[1]);
                    
                    if (!isNaN(hours) && !isNaN(minutes) && hours >= 0 && hours < 24 && minutes >= 0 && minutes < 60) {
                        // æ—¥æ™‚ã¯ãã®ã¾ã¾ã§ã€æ™‚é–“ã ã‘å¤‰æ›´
                        const newDate = new Date(log.timestamp);
                        newDate.setHours(hours);
                        newDate.setMinutes(minutes);
                        
                        // ãƒ­ã‚°ã‚’æ›´æ–°
                        logs[logIndex].timestamp = newDate.getTime();
                        
                        // æ™‚é–“é †ã«ä¸¦ã³æ›¿ãˆï¼ˆæ™‚é–“ãŒå¤‰ã‚ã£ãŸãŸã‚ï¼‰
                        logs.sort((a, b) => b.timestamp - a.timestamp);
                        
                        saveLogs();
                        updateDisplay();
                        renderHistory();
                    } else {
                        alert('æ™‚é–“ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚åŠè§’æ•°å­—ã¨ã‚³ãƒ­ãƒ³(:)ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    }
                }
            }
        }

        // æœ€æ–°æƒ…å ±ã®è¡¨ç¤º
        function updateDisplay() {
            const lastPeeLog = logs.find(log => log.type.includes('ãŠã—ã£ã“'));
            updateStatusElement('last-pee', 'last-pee-detail', lastPeeLog);

            const lastPooLog = logs.find(log => log.type.includes('ã†ã‚“ã“'));
            updateStatusElement('last-poo', 'last-poo-detail', lastPooLog);
        }

        function updateStatusElement(timeId, detailId, log) {
            const timeEl = document.getElementById(timeId);
            const detailEl = document.getElementById(detailId);

            if (log) {
                timeEl.innerHTML = formatFriendlyTime(log.timestamp);
                
                if (log.type.includes('æˆåŠŸ')) {
                    detailEl.innerHTML = 'æˆåŠŸ âœ¨';
                    detailEl.className = 'status-detail tag-ok';
                } else if (log.type.includes('å¤±æ•—')) {
                    detailEl.innerHTML = 'å¤±æ•— ğŸ’¦';
                    detailEl.className = 'status-detail tag-ng';
                } else {
                    detailEl.innerHTML = '';
                    detailEl.className = '';
                }
            } else {
                timeEl.innerHTML = '<span style="color:#ccc; font-size:1.5rem;">--:--</span>';
                detailEl.innerHTML = '';
                detailEl.className = '';
            }
        }

        function formatFriendlyTime(timestamp) {
            const targetDate = new Date(timestamp);
            const now = new Date();
            const targetDateStr = targetDate.toDateString();
            const nowDateStr = now.toDateString();
            
            const yesterdayDate = new Date(now);
            yesterdayDate.setDate(yesterdayDate.getDate() - 1);
            const yesterdayDateStr = yesterdayDate.toDateString();

            const timeStr = formatTime(timestamp);

            let dateLabel = '';
            if (targetDateStr === nowDateStr) {
                dateLabel = 'ä»Šæ—¥';
            } else if (targetDateStr === yesterdayDateStr) {
                dateLabel = 'æ˜¨æ—¥';
            } else {
                dateLabel = `${targetDate.getMonth() + 1}/${targetDate.getDate()}`;
            }
            return `<span class="date-label">${dateLabel}</span>${timeStr}`;
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        function renderHistory() {
            const listElement = document.getElementById('history-list');
            listElement.innerHTML = '';

            if (logs.length === 0) {
                listElement.innerHTML = '<li style="text-align:center; padding:20px; color:#999;">è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</li>';
                return;
            }

            let currentDateStr = '';
            const currentYear = new Date().getFullYear();

            logs.forEach(log => {
                const date = new Date(log.timestamp);
                const year = date.getFullYear();
                let headerDateStr = `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥ (${getDayName(date.getDay())})`;
                if (year !== currentYear) headerDateStr = `${year}å¹´ ${headerDateStr}`;

                if (headerDateStr !== currentDateStr) {
                    const header = document.createElement('li');
                    header.className = 'date-header';
                    header.innerText = headerDateStr;
                    listElement.appendChild(header);
                    currentDateStr = headerDateStr;
                }

                const li = document.createElement('li');
                li.className = 'log-item';
                
                let typeClass = '';
                let displayType = log.type.replace('ï¼ˆ', ' ').replace('ï¼‰', '');

                if (log.type.includes('ãŠã—ã£ã“')) {
                    if (log.type.includes('æˆåŠŸ')) typeClass = 'type-pee-ok';
                    else if (log.type.includes('å¤±æ•—')) typeClass = 'type-pee-ng';
                    else typeClass = 'type-pee-ok';
                } else if (log.type.includes('ã†ã‚“ã“')) {
                    if (log.type.includes('æˆåŠŸ')) typeClass = 'type-poo-ok';
                    else if (log.type.includes('å¤±æ•—')) typeClass = 'type-poo-ng';
                    else typeClass = 'type-poo';
                }

                li.innerHTML = `
                    <div class="log-info">
                        <span class="log-type ${typeClass}">${displayType}</span>
                        <span class="log-time">${formatTime(log.timestamp)}</span>
                    </div>
                    <div class="action-buttons">
                        <button class="edit-btn" onclick="editLog(${log.id})">ç·¨é›†</button>
                        <button class="delete-btn" onclick="deleteLog(${log.id})">å‰Šé™¤</button>
                    </div>
                `;
                listElement.appendChild(li);
            });
        }

        function toggleHistory() {
            const list = document.getElementById('history-list');
            if (list.style.display === 'none' || list.style.display === '') {
                list.style.display = 'block';
                renderHistory();
            } else {
                list.style.display = 'none';
            }
        }

        function deleteLog(id) {
            if(confirm('ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                logs = logs.filter(log => log.id !== id);
                saveLogs();
                updateDisplay();
                renderHistory();
            }
        }

        function clearAllData() {
            if(confirm('å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                localStorage.removeItem(STORAGE_KEY);
                logs = [];
                updateDisplay();
                renderHistory();
            }
        }

        function getDayName(dayIndex) {
            const days = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
            return days[dayIndex];
        }

        function saveLogs() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(logs));
        }

        function loadLogs() {
            const v4Data = localStorage.getItem('toilet_log_v4');
            if(v4Data) {
                logs = JSON.parse(v4Data);
                localStorage.setItem(STORAGE_KEY, v4Data);
                localStorage.removeItem('toilet_log_v4');
            } else {
                const data = localStorage.getItem(STORAGE_KEY);
                if (data) logs = JSON.parse(data);
            }
        }
    </script>
</body>
</html>
